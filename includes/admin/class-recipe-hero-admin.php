<?php
/**
 * @package   Recipe Hero
 * @author    Captain Theme <info@captaintheme.com>
 * @license   GPL-2.0+
 * @link      http://captaintheme.com
 * @copyright 2014 Captain Theme
 */

/**
 * Plugin class. This class should ideally be used to work with the
 * administrative side of the WordPress site.
 *
 * @package Recipe_Hero_Admin
 * @author  Captain Theme <info@captaintheme.com>
 */

if ( ! class_exists( 'Recipe_Hero_Admin' ) ) {

	class Recipe_Hero_Admin {

		/**
		 * Instance of this class.
		 *
		 * @since    0.5.0
		 *
		 * @var      object
		 */
		protected static $instance = null;

		/**
		 * Slug of the plugin screen.
		 *
		 * @since    0.5.0
		 *
		 * @var      string
		 */
		protected $plugin_screen_hook_suffix = null;

		/**
		 * Initialize the plugin by loading admin scripts & styles and adding a
		 * settings page and menu.
		 *
		 * @since     0.9.0
		 */
		private function __construct() {

			/*
			 * Call $plugin_slug from public plugin class.
			 */
			$plugin = Recipe_Hero::get_instance();
			$this->plugin_slug = $plugin->get_plugin_slug();

			// Load admin style sheet and JavaScript.
			add_action( 'admin_enqueue_scripts', array( $this, 'enqueue_admin_styles' ) );
			add_action( 'admin_enqueue_scripts', array( $this, 'enqueue_admin_scripts' ) );

			// Add an action link pointing to the options page.
			$plugin_basename = plugin_basename( plugin_dir_path( realpath( dirname( __FILE__ ) ) ) . $this->plugin_slug . '.php' );
			add_filter( 'plugin_action_links_' . $plugin_basename, array( $this, 'add_action_links' ) );

			// Let's make the magic happen on the backend
		 	// <em>The ingredients to our recipe.</em>
			require_once( RECIPE_HERO_PLUGIN_DIR . 'includes/admin/rh-tweaks.php' );
			require_once( RECIPE_HERO_PLUGIN_DIR . 'includes/admin/rh-help-tab.php' );
			require_once( RECIPE_HERO_PLUGIN_DIR . 'includes/admin/rh-columns.php' );
			require_once( RECIPE_HERO_PLUGIN_DIR . 'includes/admin/rh-admin-scripts.php' );

			// To Be Included in 1.0.0:
			// require_once( RECIPE_HERO_PLUGIN_DIR . 'includes/admin/rh-welcome.php' );

		}

		/**
		 * Return an instance of this class.
		 *
		 * @since     0.5.0
		 *
		 * @return    object    A single instance of this class.
		 */
		public static function get_instance() {

			/*
			 * - Uncomment following lines if the admin class should only be available for super admins
			 */
			/* if( ! is_super_admin() ) {
				return;
			} */

			// If the single instance hasn't been set, set it now.
			if ( null == self::$instance ) {
				self::$instance = new self;
			}

			return self::$instance;
		}

		/**
		 * Register and enqueue admin-specific style sheet.
		 *
		 * @since     0.5.0
		 *
		 * @return    null    Return early if no settings page is registered.
		 */
		public function enqueue_admin_styles() {

			if ( recipe_hero_admin_get_current_post_type() == 'recipe' ) {
				wp_enqueue_style( $this->plugin_slug .'-admin-styles', plugins_url( 'assets/css/admin.css', __FILE__ ), array(), Recipe_Hero::VERSION );
			}

		}

		/**
		 * Register and enqueue admin-specific JavaScript.
		 *
		 * @since     0.5.0
		 *
		 * @return    null    Return early if no settings page is registered.
		 */
		public function enqueue_admin_scripts() {

			if ( ! isset( $this->plugin_screen_hook_suffix ) ) {
				return;
			}

			$screen = get_current_screen();
			if ( $this->plugin_screen_hook_suffix == $screen->id ) {
				wp_enqueue_script( $this->plugin_slug . '-admin-script', plugins_url( 'assets/js/admin.js', __FILE__ ), array( 'jquery' ), Recipe_Hero::VERSION );
			}

		}

		/**
		 * Add settings action link to the plugins page.
		 *
		 * @since    0.9.0
		 */
		public function add_action_links( $links ) {

			return array_merge(
				array(
					'settings' => '<a href="' . admin_url( 'edit.php?post_type=recipe&page=recipe_hero_general_options' ) . '">' . __( 'Settings', $this->plugin_slug ) . '</a>'
				),
				$links
			);

		}

	}

}
